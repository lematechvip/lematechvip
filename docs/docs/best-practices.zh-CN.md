---
order: 2
title: æœ€ä½³å®è·µ
group:
  title: æ¡†æ¶ä½¿ç”¨
nav:
  title: æ–‡æ¡£
  path: /docs
  order: 1
---

> é€šè¿‡æœ¬ç¯‡å¸¦å¤§å®¶å¿«é€Ÿäº†è§£å¦‚ä½•åŸºäº`hrun4j`ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬å¹¶é›†æˆåˆ°éƒ¨ç½²æµæ°´çº¿ã€‚

âš¡ï¸ æ³¨æ„ï¼šåˆæ¬¡å­¦ä¹ `hrun4j`å»ºè®®å…ˆå¿«é€Ÿäº†è§£æ¡†æ¶`æ ¸å¿ƒæ¦‚å¿µ`ç¯‡

## å·¥ç¨‹ä¸‹è½½

### ä¸‹è½½æœ¬åœ°

ä¸ºä¾¿äºå¤§å®¶å¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨ï¼Œå·¥ç¨‹ä»£ç åŒ…å«å¤šä¸ªæ¨¡å—ï¼Œå†…ç½®æµ‹è¯•æœåŠ¡ç«¯æ¨¡å—ï¼Œå¯ç›´æ¥æŠŠæ•´ä¸ªä»£ç å·¥ç¨‹å…‹éš†è‡³æœ¬åœ°ï¼Œä»£ç å…‹éš†åœ°å€: `git clone https://github.com/lematechvip/hrun4j.git`

å¤‡æ³¨ï¼šå¦‚æœç½‘ç»œä¸å¥½ï¼Œé€šè¿‡giteeä¸‹è½½ï¼Œä¸‹è½½æ–¹å¼ï¼š`https://gitee.com/lematechvip/hrun4j.git`

å·¥ç¨‹ç›®å½•åˆ’åˆ†å¦‚ä¸‹ï¼š

```
â”œâ”€â”€ hrun4j-api: æä¾›apiæ¥å£æ–¹ä¾¿æ‰©å±•æˆå¹³å°
â”œâ”€â”€ hrun4j-cli: æä¾›CLIå‘½ä»¤è¡Œæ”¯æŒï¼Œæ”¯æŒç”¨ä¾‹å½•åˆ¶ï¼Œå¯å¿«é€Ÿåˆ›å»ºè„šæ‰‹æ¶ã€æµ‹è¯•ç”¨ä¾‹é›†è¿è¡ŒåŠè°ƒè¯•
â”œâ”€â”€ hrun4j-core: å·¥ç¨‹æ ¸å¿ƒæ¨¡å—ï¼Œæä¾›å®Œæ•´çš„è¿è¡Œæœºåˆ¶ã€æ•°æ®é©±åŠ¨ã€è¡¨è¾¾å¼å¼•æ“åŠæµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
â”œâ”€â”€ hrun4j-plugins: æ’ä»¶å¼é›†æˆè‡³IDEAï¼Œæä¾›æ™ºèƒ½è¡¥å…¨ã€å¿«é€Ÿå¡«å……åŠåœ¨çº¿è°ƒè¯•è¿è¡ŒåŠŸèƒ½
â”œâ”€â”€ hrun4j-test-demo: å¸¸ç”¨æ¡ˆä¾‹ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ hrun4j-test-serverï¼šå†…ç½®æµ‹è¯•æœåŠ¡ï¼ŒåŸºäºspringbootå¼€å‘ï¼Œå·¥ç¨‹è§„èŒƒæ ‡å‡†
```

### å¯¼å…¥IDEA

è¯¥å·¥ç¨‹ä¸ºå¤šæ¨¡å—é¡¹ç›®ï¼Œæ‰“å¼€IDEAæŒ‰ç…§`File->New->Project From Existing Sources`æ­¥éª¤é€‰æ‹©`hrun4j`å³å¯å®Œæˆå·¥ç¨‹å¯¼å…¥ï¼Œå¯¼å…¥ä¹‹åç­‰å¾…Maven SyncåŒæ­¥å®Œæ•´å³å¯ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š

![-w1348](http://cdn.lematech.vip/mweb/16250550561839.jpg)

## è¢«æµ‹åº”ç”¨

### å¯åŠ¨æœåŠ¡

å¦‚ä¸Šå¯çŸ¥ï¼š`hrun4j-test-server`å³ä¸ºæµ‹è¯•æœåŠ¡ï¼Œåœ¨`DemoApplication`å³é”®`Run`è¿è¡Œå³å¯å¯åŠ¨å±‚æï¼Œå¯åŠ¨è¾“å‡ºå¦‚ä¸‹ï¼š

```
 _____                                _                 __
|_   _|                              / |_              [  |
  | |      .---.  _ .--..--.   ,--. `| |-'.---.  .---.  | |--.
  | |   _ / /__\\[ `.-. .-. | `'_\ : | | / /__\\/ /'`\] | .-. |
 _| |__/ || \__., | | | | | | // | |,| |,| \__.,| \__.  | | | |
|________| '.__.'[___||__||__]\'-;__/\__/ '.__.''.___.'[___]|__]


2021-06-30 20:12:20.948 [main] INFO  vip.lematech.hrun4j.DemoApplication - Starting DemoApplication on arkhe.local with PID 6282 (/Users/arkhe/Documents/lema/others/hrun4j/hrun4j-test-server/target/classes started by arkhe in /Users/arkhe/Documents/lema/others/hrun4j) 
2021-06-30 20:12:20.951 [main] INFO  vip.lematech.hrun4j.DemoApplication - The following profiles are active: prod 
2021-06-30 20:12:25.275 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat initialized with port(s): 8000 (http) 
2021-06-30 20:12:25.291 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8000"] 
2021-06-30 20:12:25.302 [main] INFO  org.apache.catalina.core.StandardService - Starting service [Tomcat] 
2021-06-30 20:12:25.304 [main] INFO  org.apache.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.21] 
2021-06-30 20:12:25.591 [main] INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext 
2021-06-30 20:12:25.592 [main] INFO  org.springframework.web.context.ContextLoader - Root WebApplicationContext: initialization completed in 4201 ms 
2021-06-30 20:12:26.056 [main] INFO  o.s.scheduling.concurrent.ThreadPoolTaskExecutor - Initializing ExecutorService 'applicationTaskExecutor' 
2021-06-30 20:12:26.706 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8000"] 
2021-06-30 20:12:26.740 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8000 (http) with context path '' 
2021-06-30 20:12:26.744 [main] INFO  vip.lematech.hrun4j.DemoApplication - Started DemoApplication in 6.362 seconds (JVM running for 8.651) 

```

æ²¡æœ‰å¼‚å¸¸ï¼Œè¯´æ˜æœåŠ¡æ­£å¸¸å¯åŠ¨ï¼

### è®¿é—®æ¥å£æ–‡æ¡£

æµ‹è¯•æœåŠ¡å·¥ç¨‹å†…ç½®Swaggerï¼Œé€šè¿‡Swaggerå¹³å°é“¾æ¥å³å¯æŸ¥çœ‹æ¥å£ä¿¡æ¯ï¼Œè®¿é—®åœ°å€ï¼š`http://127.0.0.1:8000/swagger-ui.html`

æ¥å£æ–‡æ¡£åˆ—è¡¨ä¿¡æ¯å¦‚ä¸‹ï¼š
![-w989](http://cdn.lematech.vip/mweb/16250557476804.jpg)

è¯¥æµ‹è¯•æœåŠ¡æ˜¯ä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œæä¾›å¤šä¸ªAPIè¿›è¡Œç”¨æˆ·ç®¡ç†æ“ä½œã€‚

### ä¸šåŠ¡åœºæ™¯

![-w1081](http://cdn.lematech.vip/mweb/16251050770619.jpg)

### ä¸šåŠ¡è¦æ±‚ï¼ˆé¡»è¯»ï¼‰

ä¸šåŠ¡åœºæ™¯è¯´æ˜ğŸ”¥ğŸ”¥ğŸ”¥ï¼š

1. é™¤ç”¨æˆ·é¦–é¡µæˆ–è·å–ç™»å½•æ€æ¥å£æ— éœ€ç™»å½•å¤–ï¼Œå…¶ä»–æ¥å£éœ€å¸¦æ­£ç¡®çš„ç™»å½•æ€æ‰èƒ½æ­£å¸¸è®¿é—®
2. é€šè¿‡ç™»å½•æ€æ¥å£`/api/get-token`åŠ¨æ€ç”Ÿæˆç­¾åï¼ˆsignï¼‰ï¼Œç­¾åï¼ˆsignï¼‰ç”Ÿæˆè§„åˆ™ï¼šæ‹¼æ¥`device_sn,os_platform,app_version`å‚æ•°å€¼ï¼Œç„¶åé€šè¿‡`HmacSHA1`è¿›è¡Œ`hrun4j`åŠ ç­¾ï¼Œå…·ä½“çš„ç”Ÿæˆsignä»£ç å®ç°é€»è¾‘å¦‚ä¸‹ï¼š
      
    ```
        StringBuffer content = new StringBuffer();content.append(device_sn).append(os_platform).append(app_version);
        String crypContent = content.toString();
        String sign = SecureUtil.hmac(HmacAlgorithm.HmacSHA1, "hrun4j").digestHex(crypContent);
        LogHelper.info("åŠ å¯†ç§˜é’¥ï¼š{},åŠ å¯†å†…å®¹ï¼š{},ç”Ÿæˆçš„ç­¾åï¼š{}", TOKEN_KEY, crypContent, sign);
    ```


3. ç”¨æˆ·ç®¡ç†å…¶ä»–éœ€è®¤è¯æ¥å£è¯·æ±‚å¤´å¿…é¡»å¸¦ä¸Šdevice_snå’Œtokenæ‰èƒ½æ­£ç¡®è®¿é—®



## æµ‹è¯•æœåŠ¡

### å¿«é€Ÿåˆ›å»ºæµ‹è¯•å·¥ç¨‹

> æœ€ä½³å®è·µé‡‡ç”¨`POM`æ¨¡å¼è¿›è¡Œå·¥ç¨‹æ¼”ç¤º

âš¡ï¸  **æ³¨æ„ï¼š**`POM`å’Œ`CLI`è™½ç„¶æœ‰å·®å¼‚ï¼Œä½†æ ¸å¿ƒèµ„æºæ–‡ä»¶ç›®å½•åˆ’åˆ†åŸºæœ¬ä¸€è‡´ï¼Œä¸»è¦å·®å¼‚åœ¨è¡¨è¾¾å¼ä½¿ç”¨åŠæŒç»­é›†æˆä¸Šï¼Œå¼ºçƒˆå»ºè®®ï¼šåŸºäº`POM`æ¨¡å¼ï¼Œå»ºè®®ä½¿ç”¨`Aviator`ç¼–å†™å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œ`CLI`æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨`BeanShell`å¤„ç†å¤æ‚ä¸šåŠ¡åœºæ™¯ 

1. Macå‘½ä»¤è¡Œå·¥å…·ä¸‹è½½ï¼š`wget http://cdn.lematech.vip/hrun4j.jar`
2. å¿«é€Ÿåˆ›å»º`POM`å·¥ç¨‹ï¼š`java -jar hrun4j.jar startproject quick-start-demo`
3. quick-start-demoå·¥ç¨‹ç›®å½•ç»“æ„åˆ’åˆ†ï¼š

   ```
    â”œâ”€â”€ pom.xml
    â”œâ”€â”€ quick-start-demo.iml
    â”œâ”€â”€ readMe.md
    â””â”€â”€ src
        â”œâ”€â”€ main
        â”‚Â Â  â””â”€â”€ java
        â”‚Â Â      â””â”€â”€ vip
        â”‚Â Â          â””â”€â”€ lematech
        â”‚Â Â              â””â”€â”€ hrun4j
        â”‚Â Â                  â””â”€â”€ quickstartdemo
        â”‚Â Â                      â”œâ”€â”€ hrun4j.java
        â”‚Â Â                      â””â”€â”€ functions
        â”‚Â Â                          â””â”€â”€ MyFunction.java
        â””â”€â”€ test
            â”œâ”€â”€ java
            â”‚Â Â  â””â”€â”€ vip
            â”‚Â Â      â””â”€â”€ lematech
            â”‚Â Â          â””â”€â”€ hrun4j
            â”‚Â Â              â””â”€â”€ quickstartdemo
            â”‚Â Â                  â””â”€â”€ testcases
            â”‚Â Â                      â”œâ”€â”€ get
            â”‚Â Â                      â”‚Â Â  â””â”€â”€ GetTest.java
            â”‚Â Â                      â””â”€â”€ post
            â”‚Â Â                          â””â”€â”€ PostTest.java
            â””â”€â”€ resources
                â”œâ”€â”€ hrun4j.bsh
                â”œâ”€â”€ apis
                â”‚Â Â  â”œâ”€â”€ get.yml
                â”‚Â Â  â”œâ”€â”€ postFormData.yml
                â”‚Â Â  â””â”€â”€ postRawText.yml
                â”œâ”€â”€ data
                â”‚Â Â  â””â”€â”€ csvFile.csv
                â”œâ”€â”€ testcases
                â”‚Â Â  â”œâ”€â”€ get
                â”‚Â Â  â”‚Â Â  â””â”€â”€ getScene.yml
                â”‚Â Â  â””â”€â”€ post
                â”‚Â Â      â””â”€â”€ postScene.yml
                â””â”€â”€ testsuite
                    â”œâ”€â”€ testsuite.xml
                    â””â”€â”€ testsuite_all.xml
    
    24 directories, 16 files
   ```
   
   æç¤ºï¼šå¯¼å…¥å·¥ç¨‹ä¼šè‡ªåŠ¨ä¸‹è½½`hrun4j-core`ç›¸å…³çš„ä¾èµ–åŒ…ï¼Œè„šæœ¬ç¼–å†™å‰ï¼Œå»ºè®®å…ˆè¯»å·¥ç¨‹`ReadMe.md`æ–‡æ¡£ã€‚
   
   
### è¿è¡Œæ¼”ç¤ºæ¡ˆä¾‹
   
   ç”Ÿæˆçš„å·¥ç¨‹å†…ç½®å¤šä»½æ¼”ç¤ºæ¡ˆä¾‹ï¼Œå…ˆå¯åŠ¨æµ‹è¯•æœåŠ¡å·¥ç¨‹ï¼Œç„¶åè¿è¡Œæ¡ˆä¾‹ï¼Œçœ‹ä¸‹ç¯å¢ƒæ˜¯å¦éƒ½æ­£å¸¸ã€‚
   æ‰“å¼€æµ‹è¯•ä»£ç åŒº`GetTest.java`æ–‡ä»¶ï¼Œé€‰æ‹©`getScene`æ–¹æ³•å³é”®è¿è¡Œï¼Œè¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š
   
```
2021-07-01 16:10:35.907 [main] INFO  vip.lematech.hrun4j.helper.LogHelper -  Add function to static code block ! 
2021-07-01 16:10:38.796 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [====================getScene====================]@START 
2021-07-01 16:10:38.815 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å½“å‰æ­¥éª¤ï¼šPostman Echo GET Request And Reference Api 
hrun4j.bshæ–‡ä»¶æ‰€åœ¨è·¯å¾„å³ä¸ºé¡¹ç›®å·¥ç¨‹è·¯å¾„
ä½ å¥½ï¼Œæ¬¢è¿ä½¿ç”¨hrun4jï¼
å®˜ç½‘ï¼šhttp://www.lematech.vip
å¾®ä¿¡å…¬ä¼—å·ï¼šlematech
æŠ€æœ¯äº¤æµå¾®ä¿¡ï¼šwytest
2021-07-01 16:10:38.942 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ­£åœ¨æ‰§è¡Œï¼šshFunctionæ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°ï¼špage=<JavaType, page, null, null>,count=<JavaType, type, null, null>,type=<JavaType, count, null, null> 
2021-07-01 16:10:38.961 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚åœ°å€ï¼šhttps://postman-echo.com/get?website=http://lematech.vip&project=hrun4j&author=lematech&page={page} 
2021-07-01 16:10:38.961 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚ç±»å‹ï¼šGET 
2021-07-01 16:10:41.034 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ç ï¼š200 
2021-07-01 16:10:41.035 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ä½“ï¼š{"args":{"website":"http://lematech.vip","author":"lematech","project":"hrun4j","page":"{page}"},"headers":{"x-amzn-trace-id":"Root=1-60dd7880-68ac7f19592408a335ca7d4b","x-forwarded-proto":"https","host":"postman-echo.com","x-forwarded-port":"443","accept-encoding":"gzip","user-agent":"okhttp/3.14.9"},"url":"https://postman-echo.com/get?website=http://lematech.vip&project=hrun4j&author=lematech&page={page}"} 
2021-07-01 16:10:41.035 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å†…å®¹é•¿åº¦ï¼š423 
2021-07-01 16:10:41.035 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”æ—¶é—´ï¼š1.751 ç§’ 
2021-07-01 16:10:41.035 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å¤´ï¼š{"set-cookie":"sails.sid=s%3AexqY4rjbgTaeJYlNtjzrSjDl-Cv5LzIR.VpouynKdue7dEn2nxfebUi997lp5AE3mpibjaAhM7U4; Path=/; HttpOnly","ETag":"W/\"1a7-gWFNTHhk2lISIN3if/nYDXmiGf4\"","Connection":"keep-alive","Vary":"Accept-Encoding","Content-Length":"423","Date":"Thu, 01 Jul 2021 08:10:40 GMT","Content-Type":"application/json; charset=utf-8"} 
2021-07-01 16:10:41.035 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”cookieï¼š 
2021-07-01 16:10:41.036 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ­£åœ¨æ‰§è¡Œï¼štdFunctionæ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°ï¼š<String, This is a joke!> 
2021-07-01 16:10:41.037 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å½“å‰è¯·æ±‚å‚æ•°è¯¦ç»†ä¿¡æ¯ï¼šRequestEntity(method=GET, url=https://postman-echo.com/get?website=http://lematech.vip&project=hrun4j&author=lematech&page={page}, params=null, data=null, json=null, headers=null, connectTimeout=null, allowRedirects=true, writeTimeout=null, readTimeout=null, cookies=null, files={}, auth=null, proxy=null, stream=true) 
2021-07-01 16:10:41.037 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å½“å‰å“åº”å‚æ•°è¯¦ç»†ä¿¡æ¯ï¼šResponseEntity(statusCode=200, headers={set-cookie=sails.sid=s%3AexqY4rjbgTaeJYlNtjzrSjDl-Cv5LzIR.VpouynKdue7dEn2nxfebUi997lp5AE3mpibjaAhM7U4; Path=/; HttpOnly, ETag=W/"1a7-gWFNTHhk2lISIN3if/nYDXmiGf4", Connection=keep-alive, Vary=Accept-Encoding, Content-Length=423, Date=Thu, 01 Jul 2021 08:10:40 GMT, Content-Type=application/json; charset=utf-8}, time=1.751, body={"args":{"website":"http://lematech.vip","author":"lematech","project":"hrun4j","page":"{page}"},"headers":{"x-amzn-trace-id":"Root=1-60dd7880-68ac7f19592408a335ca7d4b","x-forwarded-proto":"https","host":"postman-echo.com","x-forwarded-port":"443","accept-encoding":"gzip","user-agent":"okhttp/3.14.9"},"url":"https://postman-echo.com/get?website=http://lematech.vip&project=hrun4j&author=lematech&page={page}"}, cookies=null, contentLength=423) 
2021-07-01 16:10:41.037 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [variables]ï¼š{author=lematech} 
2021-07-01 16:10:41.038 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [extract]ï¼š{website=http://lematech.vip, author=lematech, project=hrun4j, $RESPONSE=ResponseEntity(statusCode=200, headers={set-cookie=sails.sid=s%3AexqY4rjbgTaeJYlNtjzrSjDl-Cv5LzIR.VpouynKdue7dEn2nxfebUi997lp5AE3mpibjaAhM7U4; Path=/; HttpOnly, ETag=W/"1a7-gWFNTHhk2lISIN3if/nYDXmiGf4", Connection=keep-alive, Vary=Accept-Encoding, Content-Length=423, Date=Thu, 01 Jul 2021 08:10:40 GMT, Content-Type=application/json; charset=utf-8}, time=1.751, body={"args":{"website":"http://lematech.vip","author":"lematech","project":"hrun4j","page":"{page}"},"headers":{"x-amzn-trace-id":"Root=1-60dd7880-68ac7f19592408a335ca7d4b","x-forwarded-proto":"https","host":"postman-echo.com","x-forwarded-port":"443","accept-encoding":"gzip","user-agent":"okhttp/3.14.9"},"url":"https://postman-echo.com/get?website=http://lematech.vip&project=hrun4j&author=lematech&page={page}"}, cookies=null, contentLength=423), $REQUEST=RequestEntity(method=GET, url=https://postman-echo.com/get?website=http://lematech.vip&project=hrun4j&author=lematech&page={page}, params=null, data=null, json=null, headers=null, connectTimeout=null, allowRedirects=true, writeTimeout=null, readTimeout=null, cookies=null, files={}, auth=null, proxy=null, stream=true)} 
2021-07-01 16:10:41.153 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ£€æŸ¥ç‚¹ï¼šstatus_codeï¼Œé¢„æœŸå€¼ï¼š200ï¼Œå®é™…å€¼ï¼š200ï¼Œæµ‹è¯•ç»“è®ºï¼šé€šè¿‡ 
2021-07-01 16:10:41.158 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ£€æŸ¥ç‚¹ï¼šbody.args.websiteï¼Œé¢„æœŸå€¼ï¼šhttp://lematech.vipï¼Œå®é™…å€¼ï¼šhttp://lematech.vipï¼Œæµ‹è¯•ç»“è®ºï¼šé€šè¿‡ 
2021-07-01 16:10:41.159 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ£€æŸ¥ç‚¹ï¼š${author}ï¼Œé¢„æœŸå€¼ï¼šlematechï¼Œå®é™…å€¼ï¼šlematechï¼Œæµ‹è¯•ç»“è®ºï¼šé€šè¿‡ 
2021-07-01 16:10:41.161 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ£€æŸ¥ç‚¹ï¼š^website":"(.*?)"$ï¼Œé¢„æœŸå€¼ï¼šwebsite":"http://lematech.vip"ï¼Œå®é™…å€¼ï¼šwebsite":"http://lematech.vip"ï¼Œæµ‹è¯•ç»“è®ºï¼šé€šè¿‡ 
2021-07-01 16:10:41.162 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å½“å‰æ­¥éª¤ï¼šReference Api 
2021-07-01 16:10:41.294 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚åœ°å€ï¼šhttps://postman-echo.com/get?website=http://lematech.vip&project=hrun4j&author=lematechvip 
2021-07-01 16:10:41.295 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚ç±»å‹ï¼šGET 
2021-07-01 16:10:41.536 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ç ï¼š200 
2021-07-01 16:10:41.537 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ä½“ï¼š{"args":{"website":"http://lematech.vip","author":"lematechvip","project":"hrun4j"},"headers":{"x-amzn-trace-id":"Root=1-60dd7881-728e758b7690139541707437","x-forwarded-proto":"https","host":"postman-echo.com","x-forwarded-port":"443","accept-encoding":"gzip","user-agent":"okhttp/3.14.9"},"url":"https://postman-echo.com/get?website=http://lematech.vip&project=hrun4j&author=lematechvip"} 
2021-07-01 16:10:41.537 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å†…å®¹é•¿åº¦ï¼š401 
2021-07-01 16:10:41.538 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”æ—¶é—´ï¼š0.241 ç§’ 
2021-07-01 16:10:41.538 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å¤´ï¼š{"set-cookie":"sails.sid=s%3AvEy4XRNDyRlNfTNGxF3pSZ0tiijBOaHw.hMo7ZhqW33C5Kiwpsx5dxoHA6wfDVlJYuOssnaUvXQw; Path=/; HttpOnly","ETag":"W/\"191-1Ennk6U67LZ9hEX4nyWDm81hj8c\"","Connection":"keep-alive","Vary":"Accept-Encoding","Content-Length":"401","Date":"Thu, 01 Jul 2021 08:10:41 GMT","Content-Type":"application/json; charset=utf-8"} 
2021-07-01 16:10:41.538 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”cookieï¼š 
2021-07-01 16:10:41.541 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ£€æŸ¥ç‚¹ï¼šstatus_codeï¼Œé¢„æœŸå€¼ï¼š200ï¼Œå®é™…å€¼ï¼š200ï¼Œæµ‹è¯•ç»“è®ºï¼šé€šè¿‡ 
2021-07-01 16:10:41.542 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [====================getScene====================]@END 
2021-07-01 16:10:41.544 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [========================================]@afterSuite() 
```

æ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜ç¯å¢ƒã€ä¾èµ–é…ç½®å‡æˆåŠŸï¼Œå¯ä»¥å¼€å§‹ç¼–å†™ä¸šåŠ¡æµ‹è¯•ç”¨ä¾‹äº†ã€‚

### å¿«é€Ÿå½•åˆ¶å›æ”¾é¦–é¡µæ¡ˆä¾‹

>é€šè¿‡Swaggeråœ¨çº¿æµ‹è¯•å·¥å…·ï¼Œå¯¼å‡ºHARè¯·æ±‚æŠ¥æ–‡ï¼Œå¹¶å€ŸåŠ©`har2case`ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹

æ‰“å¼€[Swaggeræ–‡æ¡£é“¾æ¥](http://127.0.0.1:8000/swagger-ui.html)ï¼Œé€šè¿‡Swaggeråœ¨çº¿æµ‹è¯•å·¥å…·ï¼Œæµ‹è¯•`/api/`é¦–é¡µæ¥å£å¹¶å¯¼å‡ºHARæ–‡ä»¶ï¼Œå†å€ŸåŠ©`har2case`è‡ªåŠ¨ç”Ÿæˆé¦–é¡µè¯·æ±‚æ¥å£ç”¨ä¾‹ï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š

1. æ‰“å¼€[Swaggeræ–‡æ¡£é“¾æ¥](http://127.0.0.1:8000/swagger-ui.html)
2. Chromeæµè§ˆå™¨æŒ‰ä½F12å³å¯æ‰“å¼€è°ƒè¯•çª—å£ï¼Œåœ¨çº¿æµ‹è¯•`/api/`æ¥å£è·å–æ¥å£å“åº”ä¿¡æ¯
3. è°ƒè¯•æ¨¡å¼ä¸‹é€‰æ‹©è¯·æ±‚è®°å½•å¹¶å³é”®ï¼Œå¯¼å‡ºHARæ–‡ä»¶æ ¼å¼ï¼Œæ ¼å¼å‘½åï¼š`apiIndex.har`

å¦‚å›¾ï¼š
![-w992](http://cdn.lematech.vip/mweb/16251291307979.jpg)

### å›æ”¾æµé‡å¹¶ç”Ÿæˆç”¨ä¾‹

å‘½ä»¤è¡Œå·¥å…·ï¼ˆ`hrun4j.jar`ï¼‰å†…ç½®åŸºäºHARæµé‡æ–‡ä»¶è½¬æ¢æˆå¯æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚æœä¸çŸ¥é“har2caseå‘½ä»¤å¦‚ä½•ä½¿ç”¨ï¼Œå¯ä½¿ç”¨`java -jar hrun4j.jar har2case --help`æŸ¥çœ‹å¸®åŠ©ï¼Œå¸®åŠ©ä¿¡æ¯å¦‚ä¸‹ï¼š

```
Usage: java -jar hrun4j.jar har2case [--case_dir FILE] --file FILE [--filter_suffix VAL] [--filter_uri VAL] [--format VAL] [--gen_mode VAL] [--help] [--quiet]
 --case_dir FILE     : Specifies the path  of the generated use case.
 --file FILE         : Specify the HAR file path.
 --filter_suffix VAL : Filter out the specified request suffix, support
                       multiple suffix formats, multiple in English status ';'
                       division.
 --filter_uri VAL    : Filter out the URIs that meet the requirements by
                       keyword, multiple in English status ';' division.
 --format VAL        : Generate use case format, support 2y/2j. (default: 2y)
 --gen_mode VAL      : Specified generation mode, full/easy mode. (default:
                       easy)
 --help              : show help (default: true)
 --quiet             : suppress all output on stdout (default: false)
```

æµé‡å›æ”¾å‘½ä»¤ï¼š`java -jar hrun4j.jar har2case --file apiIndex.har`ï¼Œå‘½ä»¤è¾“å‡ºå¦‚ä¸‹ï¼š

```
2021-07-01 16:51:15.032 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - Start generating test cases,testcase format:2y
2021-07-01 16:51:15.191 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - Number of pages viewed: 1
2021-07-01 16:51:15.192 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [Page: http://127.0.0.1:8000/webjars/springfox-swagger-ui/images/throbber.gif (For RESTful API requests) ]
2021-07-01 16:51:15.192 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - Output the calls for this page:
2021-07-01 16:51:15.192 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - 	GET /webjars/springfox-swagger-ui/images/throbber.gif
2021-07-01 16:51:15.197 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - 	GET /api/
2021-07-01 16:51:15.615 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - Generated successfully! File path:/Users/arkhe/Desktop/apiIndex.yml
```
ç”ŸæˆæˆåŠŸï¼å½“å‰ç”Ÿæˆ`apiIndex.yml`æµ‹è¯•ç”¨ä¾‹ï¼Œç”Ÿæˆç”¨ä¾‹ä¿¡æ¯å¦‚ä¸‹ï¼š

```
config:
  name: Testcase Description
  variables: {}
  verify: false
teststeps:
- name: Request api:/webjars/springfox-swagger-ui/images/throbber.gif
  request:
    url: http://127.0.0.1:8000/webjars/springfox-swagger-ui/images/throbber.gif
    method: GET
    headers:
      sec-ch-ua: '" Not;A Brand";v="99", "Google Chrome";v="91", "Chromium";v="91"'
      sec-ch-ua-mobile: ?0
      Referer: http://127.0.0.1:8000/webjars/springfox-swagger-ui/css/screen.css
      User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36
        (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36
    allowRedirects: true
    stream: true
  validate:
  - eq:
    - status_code
    - 200
- name: Request api:/api/
  request:
    url: http://127.0.0.1:8000/api/
    method: GET
    headers:
      sec-ch-ua: '" Not;A Brand";v="99", "Google Chrome";v="91", "Chromium";v="91"'
      sec-ch-ua-mobile: ?0
      Accept: '*/*'
      Connection: keep-alive
      User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36
        (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36
      Referer: http://127.0.0.1:8000/swagger-ui.html
      Sec-Fetch-Site: same-origin
      Sec-Fetch-Dest: empty
      Host: 127.0.0.1:8000
      Accept-Encoding: gzip, deflate, br
      Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
      Sec-Fetch-Mode: cors
    allowRedirects: true
    stream: true
  validate:
  - eq:
    - status_code
    - 200
  - eq:
    - body.code
    - '00'
```

ç„¶åæŠŠ`apiIndex.yml`å¤åˆ¶åˆ°`resources/testcases`ç›®å½•ä¸‹ã€‚
å› `POM`æ¨¡å¼ä¸‹éµå¾ªè§„åˆ™å¦‚ä¸‹ï¼š

1. æµ‹è¯•å·¥ç¨‹åŒ…åç”±groupId+artifactIdç»„åˆè€Œæˆï¼Œä½œä¸ºç±»è·¯å¾„æŸ¥æ‰¾æµ‹è¯•æ•°æ®æ–‡ä»¶çš„æ ¹ç›®å½•ï¼Œå¦‚ä¸Šæ¡ˆä¾‹ï¼Œç±»è·¯å¾„é»˜è®¤æŒ‰ç…§ï¼š`/vip/lematech/hrun4j/quickstartdemo`è·¯å¾„ä½œä¸ºç³»ç»Ÿæ ¹è·¯å¾„å»æŸ¥æ‰¾æ•°æ®æ–‡ä»¶ï¼Œå¦‚æœåŒ…åå˜æ›´éœ€åŒæ­¥ä¿®æ”¹è¿è¡Œé…ç½®ï¼Œä¿®æ”¹æ–¹å¼å¦‚ä¸‹ï¼š` RunnerConfig.getInstance().setPkgName("æ–°çš„åŒ…å");`

2. åŒ…æ ¹è·¯å¾„ä¸‹çš„`testcases`å¿…é¡»å­˜åœ¨ï¼Œå®ƒå’Œèµ„æºè·¯å¾„ä¸‹çš„`testcases`æ˜¯æ˜ å°„å…³ç³»ï¼Œå…·ä½“çš„æ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š
  
    1. ä¸€ä¸ªæµ‹è¯•Javaç±»å¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¦‚æœæ–‡ä»¶å¤¹åæ˜¯demoï¼Œé‚£ä¹ˆJavaç±»ååˆ™ä¸ºDemoTest.javaï¼Œæµ‹è¯•Javaç±»å¿…é¡»ç»§æ‰¿`hrun4j`ï¼Œä»è€Œå¼•å…¥`hrun4j`èƒ½åŠ›ã€‚
    
    2. ç±»ä¸­ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä»½æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚æœæµ‹è¯•ç”¨ä¾‹åä¸º`getScene.yml`ï¼Œé‚£ä¹ˆç±»ä¸­Javaæ–¹æ³•åä¸º`getScene`ï¼Œä¸”æ–¹æ³•ç”³è¯·å¦‚ä¸‹ï¼š
       
        ```
        @Test(dataProvider = "dataProvider")
        public void getScene(TestCase testCase) {
                TestCaseExecutorEngine.getInstance().execute(testCase);
        }
        ```
        
### ç¼–å†™é¦–é¡µæ¡ˆä¾‹å¹¶è¿è¡Œ

1. åˆ›å»º`IndexTest.java`ç±»ï¼Œå¹¶æ–°å¢`apiIndex`æ–¹æ³•ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š
    
    ```
    public class IndexTest extends hrun4j {
        @Test(dataProvider = "dataProvider")
        public void apiIndex(TestCase testCase) {
            TestCaseExecutorEngine.getInstance().execute(testCase);
        }
    }
    ```

2. å³é”®è¿è¡ŒapiIndexç”¨ä¾‹

3. æ‰§è¡Œé€šè¿‡ï¼Œæ‰§è¡Œè¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š

```
2021-07-01 17:48:47.403 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å½“å‰æ­¥éª¤ï¼šRequest api:/api/ 
2021-07-01 17:48:47.405 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚åœ°å€ï¼šhttp://127.0.0.1:8000/api/ 
2021-07-01 17:48:47.409 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚ç±»å‹ï¼šGET 
2021-07-01 17:48:47.409 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚å¤´ï¼š{sec-ch-ua=" Not;A Brand";v="99", "Google Chrome";v="91", "Chromium";v="91", sec-ch-ua-mobile=?0, Accept=*/*, Connection=keep-alive, User-Agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36, Referer=http://127.0.0.1:8000/swagger-ui.html, Sec-Fetch-Site=same-origin, Sec-Fetch-Dest=empty, Host=127.0.0.1:8000, Accept-Encoding=gzip, deflate, br, Accept-Language=zh-CN,zh;q=0.9,en;q=0.8, Sec-Fetch-Mode=cors} 
2021-07-01 17:48:47.434 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ç ï¼š200 
2021-07-01 17:48:47.434 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ä½“ï¼š{"code":"00","message":"Hello,Lematech~!","timestamp":1625132927423} 
2021-07-01 17:48:47.435 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å†…å®¹é•¿åº¦ï¼š0 
2021-07-01 17:48:47.435 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”æ—¶é—´ï¼š0.024 ç§’ 
2021-07-01 17:48:47.435 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å¤´ï¼š{"Transfer-Encoding":"chunked","Date":"Thu, 01 Jul 2021 09:48:47 GMT","Content-Type":"application/json;charset=UTF-8"} 
2021-07-01 17:48:47.436 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”cookieï¼š 
2021-07-01 17:48:47.441 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ£€æŸ¥ç‚¹ï¼šstatus_codeï¼Œé¢„æœŸå€¼ï¼š200ï¼Œå®é™…å€¼ï¼š200ï¼Œæµ‹è¯•ç»“è®ºï¼šé€šè¿‡ 
2021-07-01 17:48:47.448 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ£€æŸ¥ç‚¹ï¼šbody.codeï¼Œé¢„æœŸå€¼ï¼š00ï¼Œå®é™…å€¼ï¼š00ï¼Œæµ‹è¯•ç»“è®ºï¼šé€šè¿‡ 
2021-07-01 17:48:47.453 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [====================apiIndex====================]@END 
2021-07-01 17:48:47.455 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [========================================]@afterSuite() 
```

ğŸ”¥ğŸ”¥ğŸ”¥æ­å–œä½ ! ä½ åŸºäºPOMæ¨¡å¼å·²ç»å®Œæˆäº†ç¬¬ä¸€ä¸ªæ¡ˆä¾‹å½•åˆ¶å›æ”¾ï¼Œç»§ç»­çœ‹ï¼Œåé¢è¿˜æœ‰æ›´å¤šæœ‰æ„æ€çš„ä¸œè¥¿ç­‰ç€ä½ ï¼

**å…³äºæµ‹è¯•ç”¨ä¾‹æ•°æ®æ–‡ä»¶æ ¼å¼ï¼Œå¯å‚è€ƒæéš†å…„`HttpRunner`æ ¼å¼ï¼š[è¿™é‡Œ](https://v2.httprunner.org/prepare/testcase-structure/)**

### ç¼–å†™è·å–ç™»å½•æ€æ¡ˆä¾‹

ä¸Šé¢æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä¼šç»§ç»­å®Œå–„å…¶ä»–æµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥åŒæ ·æ–¹å¼ç”ŸæˆgetTokenæµ‹è¯•ç”¨ä¾‹ï¼Œè¿è¡Œä¹‹åæ•ˆæœå¦‚ä¸‹ï¼š

```
2021-07-01 18:21:58.355 [main] INFO  vip.lematech.hrun4j.helper.LogHelper -  Add function to static code block ! 
2021-07-01 18:22:00.966 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [====================getToken====================]@START 
2021-07-01 18:22:00.978 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å½“å‰æ­¥éª¤ï¼šRequest api:/api/get-token 
2021-07-01 18:22:00.983 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚åœ°å€ï¼šhttp://127.0.0.1:8000/api/get-token 
2021-07-01 18:22:00.984 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚ç±»å‹ï¼šPOST 
2021-07-01 18:22:01.220 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚å¤´ï¼š{Origin=http://127.0.0.1:8000, Accept=*/*, device_sn=lematech, app_version=1.0.0, os_platform=pc, Connection=keep-alive, User-Agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36, Referer=http://127.0.0.1:8000/swagger-ui.html, Sec-Fetch-Site=same-origin, Sec-Fetch-Dest=empty, Host=127.0.0.1:8000, Accept-Encoding=gzip, deflate, br, Sec-Fetch-Mode=cors, sec-ch-ua=" Not;A Brand";v="99", "Google Chrome";v="91", "Chromium";v="91", sec-ch-ua-mobile=?0, Accept-Language=zh-CN,zh;q=0.9,en;q=0.8, Content-Length=22, Content-Type=application/json} 
2021-07-01 18:22:01.221 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚jsonï¼š{"sign":"string"} 
2021-07-01 18:22:01.317 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ç ï¼š200 
2021-07-01 18:22:01.318 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ä½“ï¼š{"code":"403","message":"è®¤è¯å¤±è´¥ï¼","timestamp":1625134921280} 
2021-07-01 18:22:01.318 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å†…å®¹é•¿åº¦ï¼š0 
2021-07-01 18:22:01.318 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”æ—¶é—´ï¼š0.069 ç§’ 
2021-07-01 18:22:01.319 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å¤´ï¼š{"Transfer-Encoding":"chunked","Date":"Thu, 01 Jul 2021 10:22:01 GMT","Content-Type":"application/json;charset=UTF-8"} 
2021-07-01 18:22:01.319 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”cookieï¼š 
2021-07-01 18:22:01.426 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ£€æŸ¥ç‚¹ï¼šstatus_codeï¼Œé¢„æœŸå€¼ï¼š200ï¼Œå®é™…å€¼ï¼š200ï¼Œæµ‹è¯•ç»“è®ºï¼šé€šè¿‡ 
2021-07-01 18:22:01.429 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ£€æŸ¥ç‚¹ï¼šbody.codeï¼Œé¢„æœŸå€¼ï¼š403ï¼Œå®é™…å€¼ï¼š403ï¼Œæµ‹è¯•ç»“è®ºï¼šé€šè¿‡ 
2021-07-01 18:22:01.431 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [====================getToken====================]@END 
2021-07-01 18:22:01.435 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [========================================]@afterSuite() 
```

é€šè¿‡ä¸Šé¢çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å‘ç°æ¥å£è·‘é€šäº†ï¼Œä½†**è®¤è¯å¤±è´¥ğŸğŸğŸ**äº†ï¼ï¼ï¼

ä¸ºä½•æ¥å£ä¼šè®¤è¯å¤±è´¥ï¼Ÿåœ¨ä¸šåŠ¡è¦æ±‚è¯´æ˜æ›¾ç»è¯´è¿‡ï¼Œtokenç”Ÿæˆéœ€è¦ä¼ signä¸”signå€¼éœ€è¦ç»è¿‡ä¸€ç³»åˆ—åŠ¨æ€åŠ å¯†ç”Ÿæˆçš„æ‰ç¬¦åˆè¦æ±‚ï¼Œå› æ­¤signç”Ÿæˆéœ€è¦å€ŸåŠ©è¡¨è¾¾å¼æ¥å®Œæˆã€‚

`hrun4j`æä¾›ä¸¤ç§è¡¨è¾¾å¼è„šæœ¬ï¼Œä¸€ç§æ˜¯`BeanShell`ï¼Œå¦ä¸€ç§æ˜¯`Aviator`ï¼Œä¸¤ç§è„šæœ¬å·®å¼‚æ€§åŠä½¿ç”¨ï¼Œå‚è€ƒFAQå’Œè„šæœ¬ä½¿ç”¨æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©`Aviator`å®ŒæˆåŠ¨æ€Signçš„ç”Ÿæˆã€‚

#### ç¼–å†™Aviatorè‡ªå®šä¹‰è„šæœ¬

>âš¡ï¸ æ³¨æ„ï¼š`hrun4j`æ¶‰åŠåˆ°å˜é‡å¼•ç”¨ã€è¡¨è¾¾å¼å¼•ç”¨ã€è„šæœ¬å¼•ç”¨åŠæ–‡ä»¶å¼•ç”¨ï¼Œä¸€å¾‹é‡‡ç”¨${å˜é‡|è¡¨è¾¾å¼|å†…ç½®å‡½æ•°}æ–¹å¼
> 1. å¼•ç”¨å˜é‡aï¼š${a}
> 2. å¼•ç”¨è‡ªå®šä¹‰è¡¨è¾¾å¼ï¼š${defineMethod(param1,param2,param3)}
> 3. å¼•ç”¨å†…ç½®å‡½æ•°ï¼š${helloWorld()}
> 4. å¼•ç”¨æµ‹è¯•æ•°æ®ï¼š${P(æ–‡ä»¶ç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„)}
> 5. å¼•ç”¨BeanShellè„šæœ¬ï¼š${BSH(è„šæœ¬ç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„)}
> 6. å¼•ç”¨Aviatorè¡¨è¾¾å¼ï¼š${aviatorè¯­æ³•}

éå¸¸å¼ºå¤§ï¼Œéå¸¸æ–¹ä¾¿ï¼

è‡ªå®šä¹‰Aviatorè¡¨è¾¾å¼å®šä¹‰æ–¹å¼å¦‚ä¸‹ï¼š

1. è‡ªå®šä¹‰ä¸€ä¸ªJavaç±»`SignGenerateFunction`ç»§æ‰¿`AbstractFunction`ç±»
2. é‡å†™`call`å’Œ`getName`æ–¹æ³•ï¼Œå…³äºé‡å†™çš„æ–¹æ³•è¯´æ˜å¦‚ä¸‹ï¼š
    * callæ–¹æ³•ï¼šå‡½æ•°å†…éƒ¨ä¸šåŠ¡é€»è¾‘å®ç°,ç”¨äºå¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Œå¯é€šè¿‡`env`æ¥æ”¶ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡ä¿¡æ¯ï¼Œå¯é€šè¿‡`AviatorObject... args` æ¥æ”¶å¤šä¸ªå¯å˜è‡ªå®šä¹‰å‚æ•°
    * getNameï¼šè¡¨è¾¾å¼åç§°æˆ–è‡ªå®šä¹‰å‡½æ•°åå­—
3. `MyFunction`ç”¨äºå½’çº³è‡ªå®šä¹‰è¡¨è¾¾å¼ç±»ï¼Œå¯æŠŠ`SignGenerateFunction`ç±»æ”¾åˆ°`MyFunction`ä¸­ç®¡ç†

æœ€ç»ˆè‡ªå®šä¹‰è¡¨è¾¾å¼ä»£ç å¦‚ä¸‹ï¼š

```
public class MyFunction {
    public static final String TOKEN_KEY = "hrun4j";
    public static class SignGenerateFunction extends AbstractFunction {
        @Override
        public AviatorObject call(Map<String, Object> env, AviatorObject arg1, AviatorObject arg2, AviatorObject arg3) {
            StringBuffer content = new StringBuffer();
            content.append(arg1.getValue(env)).append(arg2.getValue(env)).append(arg3.getValue(env));
            String crypContent = content.toString();
            String sign = SecureUtil.hmac(HmacAlgorithm.HmacSHA1, TOKEN_KEY).digestHex(crypContent);
            LogHelper.info("åŠ å¯†ç§˜é’¥ï¼š{},åŠ å¯†å†…å®¹ï¼š{},ç”Ÿæˆçš„ç­¾åï¼š{}", TOKEN_KEY, crypContent, sign);
            return new AviatorString(sign);
        }
        @Override
        public String getName() {
            return "signGenerate";
        }
    }
}
```

è¡¨è¾¾å¼è¯´æ˜ï¼šè¯¥è¡¨è¾¾å¼åç§°æ˜¯`signGenerate`,å¯æ¥æ”¶3ä¸ªè‡ªå®šä¹‰å‚æ•°åŠä¸Šä¸‹æ–‡å˜é‡ï¼ˆé»˜è®¤å¸¦ï¼‰

æ˜¯ä¸æ˜¯è¡¨è¾¾å¼å†™å¥½äº†å°±å¯ä»¥äº†å—ï¼Ÿ ä¸æ˜¯çš„ï¼Œè¿˜éœ€è¦æŠŠè‡ªå®šä¹‰å‡½æ•°æ·»åŠ åˆ°è¡¨è¾¾å¼ç®¡ç†å™¨ä¸­ï¼Œå…·ä½“æ·»åŠ è¡¨è¾¾å¼ä»£ç å¾ˆç®€å•ï¼š

```
AviatorEvaluator.addFunction(new MyFunction.SetupHookFunction());
```

å…¶ä¸­AviatorEvaluatorä¸ºå•ä¾‹æ¨¡å¼ï¼Œå› æ­¤å¯ä»¥è°ƒç”¨ç›´æ¥æ·»åŠ æ–°çš„å‡½æ•°ã€‚

âš¡ï¸ **æ³¨æ„ï¼š`hrun4j`è§„å®šï¼šæ·»åŠ è¡¨è¾¾å¼ã€åˆå§‹åŒ–è¿è¡Œé…ç½®åŠhrun4jèƒ½åŠ›ç»§æ‰¿ï¼Œå…¨éƒ¨é›†ä¸­åœ¨`hrun4j.java`æ–‡ä»¶ä¸­ç®¡ç†**

å› æ­¤æœ€å`Hrun4j.java`ä»£ç ç»“æ„å¦‚ä¸‹ï¼š

```
public class Hrun4j extends TestBase {
    @Override
    @BeforeSuite
    public void beforeSuite(){
        LogHelper.info(" Add function to static code block !");
        AviatorEvaluator.addFunction(new MyFunction.SetupHookFunction());
        AviatorEvaluator.addFunction(new MyFunction.TearDownHookFunction());
        AviatorEvaluator.addFunction(new MyFunction.SignGenerateFunction());

        /**
        * åŒ…åï¼Œèµ„æºè·¯å¾„ä¸‹æŸ¥æ‰¾æµ‹è¯•ç”¨ä¾‹å‰ç½®ï¼Œé»˜è®¤ï¼švip.lematech.hrun4j
        */
        RunnerConfig.getInstance().setPkgName("vip.lematech.hrun4j.quickstartdemo");
        /**
        * Test case file suffix
        */
        RunnerConfig.getInstance().setTestCaseExtName(Constant.SUPPORT_TEST_CASE_FILE_EXT_YML_NAME);
    }
}
```
åŒ…å«äº†åŠ è½½è‡ªå®šä¹‰è¡¨è¾¾å¼ã€åˆå§‹åŒ–é…ç½®åŠæµ‹è¯•èƒ½åŠ›ç»§æ‰¿ï¼Œåç»­æµ‹è¯•ä»£ç ç±»å¯ç›´æ¥é›†æˆ`hrun4j`å®Œæˆåˆå§‹åŒ–æ“ä½œã€‚

#### ç¼–å†™BeanShellè‡ªå®šä¹‰è„šæœ¬

å¦‚æœè§‰å¾—aviatoræœ‰ç‚¹éº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™`Beanshell`è„šæœ¬æ¥è§£å†³å¤æ‚ä¸šåŠ¡é€»è¾‘é—®é¢˜ï¼Œä»–ä¸ä»…å¯ä»¥å®ç°å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Œè¿˜èƒ½è¿›è¡Œå¤æ‚ä¸šåŠ¡éªŒè¯å“¦ï¼

1. åœ¨æµ‹è¯•èµ„æºï¼ˆ`resources`ï¼‰åˆ›å»º`bsh`ç›®å½•ï¼Œ`bsh`ç›®å½•ç”¨äºå­˜å‚¨`BeanShell`è„šæœ¬
2. ç¼–å†™`BeanShell`ï¼Œå¹¶å‘½åæˆ`signGenerate.bsh`ï¼Œç”¨äºå¤„ç†`sign`ç”Ÿæˆ
    
    ```
        #!/bin/java bsh.Interpreter
        import cn.hutool.crypto.SecureUtil;
        import cn.hutool.crypto.digest.HmacAlgorithm;
        import vip.lematech.hrun4j.helper.LogHelper;
        public static final String TOKEN_KEY = "hrun4j";
        print("BeanShellè„šæœ¬å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘");
        print("è¯·æ±‚å‚æ•°ï¼š"+$REQUEST);
        print("å“åº”å‚æ•°ï¼š"+$RESPONSE);
        print("ä¸Šä¸‹æ–‡å‚æ•°ï¼š"+$ENV);
        print("ä¸Šä¸‹æ–‡å‚æ•°ï¼š"+$ENV.get("device_sn"));
        StringBuffer content = new StringBuffer();
    content.append($ENV.get("device_sn")).append($ENV.get("os_platform")).append($ENV.get("app_version"));
        String crypContent = content.toString();
        String sign = SecureUtil.hmac(HmacAlgorithm.HmacSHA1, TOKEN_KEY).digestHex(crypContent);
        return sign;
    ```
    
3. æ–°å¢`getTokenByBSH.yml`æ–‡ä»¶ï¼Œé€šè¿‡`$BSH('bsh/signGenerate.bsh')`å¼•ç”¨å¹¶èµ‹å€¼
   
   ```
           config:
          name: Testcase Description
        teststeps:
        - name: Request api:/api/get-token
          variables:
            device_sn: lematech
            os_platform: pc
            app_version: 1.0.0
          request:
            url: http://127.0.0.1:8000/api/get-token
            method: POST
            headers:
              device_sn: ${device_sn}
              app_version: ${app_version}
              os_platform: ${os_platform}
            json:
              sign: ${BSH('bsh/signGenerate.bsh')}
          validate:
          - eq:
            - status_code
            - 200
          - eq:
            - body.code
            - '00'
          extract:
            - token: body.data.token
   ```

âš¡ï¸æ³¨æ„ï¼šå…³äºBeanShellè„šæœ¬ç¼–å†™
1. `$REQUEST`ï¼šæ¡†æ¶å†…ç½®å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å½“å‰æ¥å£è¯·æ±‚å‚æ•°
2. `$RESPONSE`ï¼šæ¡†æ¶å†…ç½®å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å½“å‰æ¥å£å“åº”å‚æ•°
3. `ENV`ï¼šæ¡†æ¶å†…ç½®å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨ä¸Šä¸‹æ–‡å‚æ•°
4. `BeanShell`ï¼šé€šè¿‡`return value`ï¼Œå®Œæˆå‚æ•°èµ‹å€¼
    
#### åœ¨è„šæœ¬ä¸­ä½¿ç”¨è‡ªå®šä¹‰è¡¨è¾¾å¼

1. ç¼–è¾‘getToken.ymlï¼Œåœ¨signçš„å–å€¼æ—¶é€šè¿‡è¡¨è¾¾å¼ç”Ÿæˆå³`${signGenerate(device_sn,os_platform,app_version)}`

2. æŠŠåŠ ç­¾ç›¸å…³å‚æ•°`device_sn|os_platform|app_version`æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºè‡ªå®šä¹‰å˜é‡ï¼Œæ”¾åˆ°`teststep.variables`ä¹Ÿå¯ä»¥æ”¾åˆ°`config.variables`
   
   âš¡ï¸**æ³¨æ„ï¼šå¦‚æœä¸æŠ½å–å‡ºæ”¾åœ¨variablesï¼Œä¸‰ä¸ªå‚æ•°å€¼å‡ä¸ºnull**

3. æ”¹é€ åï¼ˆæ ¡éªŒã€è¡¨è¾¾å¼ï¼‰è„šæœ¬å¦‚ä¸‹ï¼š
    
    ```
        config:
          name: Testcase Description
    teststeps:
    - name: Request api:/api/get-token
          variables:
             device_sn: lematech
             os_platform: pc
             app_version: 1.0.0
          request:
             url: http://127.0.0.1:8000/api/get-token
             method: POST
             headers:
               device_sn: ${device_sn}
               app_version: ${app_version}
               os_platform: ${os_platform}
            json:
              sign: ${signGenerate(device_sn,os_platform,app_version)}
          validate:
          - eq:
             - status_code
             - 200
          - eq:
             - body.code
             - '403'

    ```
    
    âš¡ï¸æ³¨æ„ï¼š
    1. æ­¥éª¤ç›¸å…³çš„å˜é‡å­˜æ”¾åœ¨`teststep.variables`,é…ç½®ç›¸å…³çš„å˜é‡å­˜æ”¾åœ¨`config.variables`
    2. å˜é‡ã€æ–¹æ³•å¼•ç”¨æ–¹å¼ï¼š`${å˜é‡å|æ–¹æ³•å}`ï¼Œå…¶ä¸­æ–¹æ³•åé‡Œé¢çš„å‚æ•°ä¸éœ€è¦å†åŠ `${å˜é‡å}`


#### è°ƒè¯•è·å–ç™»å½•æ€æµ‹è¯•ç”¨ä¾‹

å†æ¬¡è°ƒè¯•ï¼Œå‘ç°è„šæœ¬ä¾ç„¶æ‰§è¡Œå¤±è´¥ï¼Œä½†é€šè¿‡æ—¥å¿—æŸ¥çœ‹ï¼Œè„šæœ¬å·²ç»æˆåŠŸç”ŸæˆTokenï¼Œåªæ˜¯å½•åˆ¶å›æ”¾çš„`body.code`å€¼è®¾ç½®æˆ403ï¼ŒæŠŠè„šæœ¬body.codeè°ƒæ•´æˆ00å³å¯ï¼Œå®Œæ•´æ—¥å¿—è¾“å‡ºå¦‚ä¸‹ï¼š

```
2021-07-01 22:56:05.313 [main] INFO  vip.lematech.hrun4j.helper.LogHelper -  Add function to static code block ! 
2021-07-01 22:56:07.959 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [====================getToken====================]@START 
2021-07-01 22:56:07.984 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å½“å‰æ­¥éª¤ï¼šRequest api:/api/get-token 
2021-07-01 22:56:08.291 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - åŠ å¯†ç§˜é’¥ï¼šhrun4j,åŠ å¯†å†…å®¹ï¼šlematechpc1.0.0,ç”Ÿæˆçš„ç­¾åï¼šd7993d412279a0f32437733fbb277ba3c70a58d0 
2021-07-01 22:56:08.298 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚åœ°å€ï¼šhttp://127.0.0.1:8000/api/get-token 
2021-07-01 22:56:08.298 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚ç±»å‹ï¼šPOST 
2021-07-01 22:56:08.428 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚å¤´ï¼š{device_sn=lematech, app_version=1.0.0, os_platform=pc} 
2021-07-01 22:56:08.429 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚jsonï¼š{"sign":"d7993d412279a0f32437733fbb277ba3c70a58d0"} 
2021-07-01 22:56:08.547 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ç ï¼š200 
2021-07-01 22:56:08.548 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ä½“ï¼š{"code":"00","data":{"token":"u8nxnss22hsvh3hl"},"message":"okï¼","timestamp":1625151368509} 
2021-07-01 22:56:08.548 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å†…å®¹é•¿åº¦ï¼š0 
2021-07-01 22:56:08.548 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”æ—¶é—´ï¼š0.089 ç§’ 
2021-07-01 22:56:08.548 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å¤´ï¼š{"Transfer-Encoding":"chunked","Date":"Thu, 01 Jul 2021 14:56:08 GMT","Content-Type":"application/json;charset=UTF-8"} 
2021-07-01 22:56:08.549 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”cookieï¼š 
2021-07-01 22:56:08.712 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ£€æŸ¥ç‚¹ï¼šstatus_codeï¼Œé¢„æœŸå€¼ï¼š200ï¼Œå®é™…å€¼ï¼š200ï¼Œæµ‹è¯•ç»“è®ºï¼šé€šè¿‡ 
2021-07-01 22:56:08.715 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - æ£€æŸ¥ç‚¹ï¼šbody.codeï¼Œé¢„æœŸå€¼ï¼š00ï¼Œå®é™…å€¼ï¼š00ï¼Œæµ‹è¯•ç»“è®ºï¼šé€šè¿‡ 
2021-07-01 22:56:08.722 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [====================getToken====================]@END 
2021-07-01 22:56:08.725 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - [========================================]@afterSuite() 

```

è‡³æ­¤ï¼Œè·å–ç™»å½•æ€æ¡ˆä¾‹å·²ç»å†™å®Œäº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•å•Šï¼ï¼ï¼

### ç¼–å†™æ·»åŠ ç”¨æˆ·ç”¨ä¾‹

é€šè¿‡ä»¥ä¸Šä¸¤ä¸ªæ¡ˆä¾‹ï¼Œå·²ç»å¯¹`hrun4j POM`æœ‰ä¸€å®šäº†è§£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­ä»€ä¹ˆå­¦ä¹ å…¶è§„åˆ™ï¼š

#### ç¼–å†™æ·»åŠ ç”¨ä¾‹è„šæœ¬

ä»¥åŒæ ·æ–¹å¼ï¼ˆ`har2case`ï¼‰ç”Ÿæˆæ·»åŠ ç”¨æˆ·æµ‹è¯•ç”¨ä¾‹ï¼Œè¯·æ±‚æ¥å£ï¼š`POST /api/user/{uid}`ï¼Œç„¶åç”Ÿæˆæ·»åŠ ç”¨æˆ·`addUser.yml`è„šæœ¬å¦‚ä¸‹ï¼š

```
config:
  name: Testcase Description
  variables: {}
  verify: false
teststeps:
- name: Request api:/api/user/123
  request:
    url: http://127.0.0.1:8000/api/user/123
    method: POST
    headers:
      Origin: http://127.0.0.1:8000
      Accept: '*/*'
      Connection: keep-alive
      User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36
        (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36
      Referer: http://127.0.0.1:8000/swagger-ui.html
      Sec-Fetch-Site: same-origin
      Sec-Fetch-Dest: empty
      Host: 127.0.0.1:8000
      Accept-Encoding: gzip, deflate, br
      Sec-Fetch-Mode: cors
      sec-ch-ua: '" Not;A Brand";v="99", "Google Chrome";v="91", "Chromium";v="91"'
      sec-ch-ua-mobile: ?0
      Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
      Content-Length: '45'
      Content-Type: application/json
    json:
      password: passwod
      name: name
    allowRedirects: true
    stream: true
  validate:
  - eq:
    - status_code
    - 200
  - eq:
    - body.code
    - '09'
```

è¿™ä¸ªæ¥å£è™½ç„¶å½•åˆ¶å›æ”¾æˆåŠŸäº†ï¼Œä½†æ¥å£ä¸å±äºæ­£å¸¸ä¸šåŠ¡åœºæ™¯ï¼Œå› ä¸Šé¢è¯·æ±‚åå°ä¼šæç¤ºï¼š`{"code":"09","message":" header device_sn is required","data":null,"timestamp":1625281678543}`ï¼Œè¿™ä¸ªæç¤ºæ˜¯æ­£å¸¸çš„ã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹æ·»åŠ ç”¨æˆ·åç«¯æ¥å£å®šä¹‰ï¼š

```java
    @PostMapping(value = "/get-token")
    public R getToken(@RequestHeader(value = "device_sn") String deviceSN,
                      @RequestHeader(value = "os_platform", required = false) String osPlatform,
                      @RequestHeader(value = "app_version", required = false) String appVersion,
                      @RequestBody TokenVO tokenVO) {
        String expectSign = tokenServiceImpl.generateToken(deviceSN, osPlatform, appVersion);
        log.info("sign: {}", expectSign);
        boolean validateResult = tokenServiceImpl.validateToken(tokenVO.getSign(), expectSign);
        if (!validateResult) {
            return R.fail(CommonBusinessCode.Authorization_FAILED_EXCEPTION);
        }
        String token = RandomUtil.randomString(16);
        tokenServiceImpl.storyToken(deviceSN, token);
        Map resultData = Maps.newHashMap();
        resultData.put("token", token);
        return R.ok(resultData);
    }
```

é€šè¿‡å¯¹æ§åˆ¶å±‚æ¥å£å®šä¹‰ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œå½“å‰æ¥å£è¯·æ±‚å¤´å¿…é¡»å¸¦`device_sn`


åœ¨æŠŠ`addUser.yml`è„šæœ¬æ‹·è´åœ¨`resources/testcases`ç›®å½•å‰ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºuserç›®å½•ï¼Œè¿™ä¸ªç›®å½•ç”¨äºç®¡ç†ç”¨æˆ·æ¨¡å—ä¸šåŠ¡åœºæ™¯ï¼Œåˆ›å»ºå®ŒæˆåæŠŠ`addUser.yml`æ‹·è´è¿‡å»ï¼Œå› æµ‹è¯•ç”¨ä¾‹åŠæ‰€åœ¨ç›®å½•å’Œæµ‹è¯•ä»£ç å­˜åœ¨æ˜ å°„å…³ç³»ï¼Œå› æ­¤æˆ‘ä»¬å¾—åœ¨ä»£ç åŒºåˆ›å»º`user`å­åŒ…å’Œ`UserTest.java`æ–‡ä»¶å¹¶æ·»åŠ `addUser`æ–¹æ³•ã€‚

æœ€ç»ˆç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

![-w648](http://cdn.lematech.vip/mweb/16252828669484.jpg)

æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š

![-w1084](http://cdn.lematech.vip/mweb/16252829098853.jpg)

âš¡ï¸æ³¨æ„ï¼šæ–°å¢æµ‹è¯•ä»£ç ç±»å¿…é¡»é›†æˆ`hrun4j`æ‰èƒ½å¼•å…¥å…¶èƒ½åŠ›ï¼Œæµ‹è¯•æ–¹æ³•æ˜¯è§„å®šæ ¼å¼è¦æ±‚ï¼ˆæ•°æ®é©±åŠ¨ã€æµ‹è¯•æ–¹æ³•æ‰§è¡ŒåŠæ–¹æ³•åå’Œæµ‹è¯•è„šæœ¬åä¸€è‡´ï¼‰

æˆ‘ä»¬ç»§ç»­ä¼˜åŒ–æµ‹è¯•è„šæœ¬ï¼Œéœ€è¦ä¿®æ”¹`addUser.yml`è„šæœ¬ï¼Œæ·»åŠ `device_sn`è¯·æ±‚å¤´ï¼Œä½†è¯·æ±‚å¤´å“ªé‡Œæ¥çš„å‘¢ï¼Ÿé¦–å…ˆä»–æ˜¯é€šè¿‡`get-token`ç”¨ä¾‹ç”Ÿæˆçš„ï¼Œå…¶æ¬¡æˆ‘ä»¬éœ€è¦æŠŠä»–æå–å‡ºæ¥ï¼Œç»™`addUser`ç”¨ä¾‹ç”¨ã€‚ 

è¿™ä¸¤éƒ¨æ“ä½œåœ¨æ¥å£æµ‹è¯•å®šä¹‰æˆï¼š**æµ‹è¯•ç”¨ä¾‹ä¾èµ–&æ•°æ®ä¾èµ–**ï¼Œ`hrun4j`å·²ç»æä¾›äº†ä¸€å¥—è¾ƒä¸ºå®Œå–„çš„è§£å†³æ–¹æ¡ˆã€‚

1. æµ‹è¯•ç”¨ä¾‹ä¾èµ–
    åœ¨æµ‹è¯•æ­¥éª¤`teststep`ä¸­ï¼Œå¯ç›´æ¥å¼•ç”¨å…¶ä»–ç”¨ä¾‹(`testcase: ç”¨ä¾‹è·¯å¾„`)ï¼Œä»è€Œè§£å†³ç”¨ä¾‹ä¾èµ–é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬ä¿®æ”¹`addUser.yml`è„šæœ¬æ­¥éª¤ï¼Œåœ¨æ·»åŠ ç”¨æˆ·å‰ï¼Œå…ˆç™»å½•ï¼Œæœ€ç»ˆè„šæœ¬å¦‚ä¸‹ï¼š
    
    ```
        config:
          name: Testcase Description
          variables: {}
          verify: false
    teststeps:
        - name: ç”¨æˆ·ç™»å½•
          testcase: getToken.yml
        - name: Request api:/api/user/123
          request:
            url: http://127.0.0.1:8000/api/user/123
            method: POST
            headers:
              device_sn: lematech
              Content-Type: application/json
            json:
              password: passwod
              name: name
          validate:
          - eq:
            - status_code
            - 200
          - eq:
            - body.code
            - '09'
    ```
    
    âš¡ï¸æ³¨æ„ï¼š`teststep`é€šè¿‡æŒ‡å®š`testcase`å‚æ•°å¼•ç”¨å…¶ä»–ç”¨ä¾‹
2. æ•°æ®ä¾èµ–
    
    ä¸Šé¢è™½ç„¶è§£å†³äº†ç”¨ä¾‹ä¾èµ–é—®é¢˜ï¼Œä½†è·‘å®Œå‘ç°ï¼Œæ·»åŠ ç™»å½•æ¥å£ä¾ç„¶æç¤ºéœ€è¦ç™»å½•ï¼ˆ`{"code":"09","message":" header token is required","timestamp":1625283730633} `ï¼‰ï¼Œå› ä¸ºæ²¡æœ‰ä¼ tokenå€¼ï¼Œé‚£tokenå€¼æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ`token`çš„å€¼æ˜¯é€šè¿‡ä¸Šä¸ªæ¥å£ç”Ÿæˆçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠä¸Šä¸€ä¸ªå‚æ•°è¿”å›çš„ç»“æœæå–å‡ºæ¥ï¼Œç„¶ååœ¨ä¸‹ä¸€ä¸ªæ¥å£ä¸­ä½¿ç”¨ã€‚
    
* å‚æ•°å¦‚ä½•æå–ï¼Ÿ

    è¿”å›ç»“æœæ•°æ®æå–æ–¹å¼æœ‰4ç§ï¼Œ`hrun4j`æ”¯æŒ`jsonpath/jmespath/æ­£åˆ™/å¯¹è±¡æå–`ï¼Œæå¤§çš„æ–¹ä¾¿äº†æ•°æ®æå–æ–¹å¼ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹è¿”å›ç»“æœå­˜å‚¨åœ¨ä»€ä¹ˆä½ç½®åŠç»“æ„å¦‚ä½•ï¼š
    
    ```
    2021-07-03 11:42:09.916 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å½“å‰æ­¥éª¤ï¼šRequest api:/api/get-token 
2021-07-03 11:42:10.207 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - åŠ å¯†ç§˜é’¥ï¼šhrun4j,åŠ å¯†å†…å®¹ï¼šlematechpc1.0.0,ç”Ÿæˆçš„ç­¾åï¼šd7993d412279a0f32437733fbb277ba3c70a58d0 
2021-07-03 11:42:10.217 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚åœ°å€ï¼šhttp://127.0.0.1:8000/api/get-token 
2021-07-03 11:42:10.218 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚ç±»å‹ï¼šPOST 
2021-07-03 11:42:10.295 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚å¤´ï¼š{device_sn=lematech, app_version=1.0.0, os_platform=pc} 
2021-07-03 11:42:10.296 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - è¯·æ±‚jsonï¼š{"sign":"d7993d412279a0f32437733fbb277ba3c70a58d0"} 
2021-07-03 11:42:10.433 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ç ï¼š200 
2021-07-03 11:42:10.434 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”ä½“ï¼š{"code":"00","data":{"token":"9et5witl0o791k7m"},"message":"okï¼","timestamp":1625283730378} 
2021-07-03 11:42:10.434 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å†…å®¹é•¿åº¦ï¼š0 
2021-07-03 11:42:10.435 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”æ—¶é—´ï¼š0.101 ç§’ 
2021-07-03 11:42:10.436 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”å¤´ï¼š{"Transfer-Encoding":"chunked","Date":"Sat, 03 Jul 2021 03:42:10 GMT","Content-Type":"application/json;charset=UTF-8"} 
2021-07-03 11:42:10.436 [main] INFO  vip.lematech.hrun4j.helper.LogHelper - å“åº”cookieï¼š 
    ```
    
    å¯ä»¥çœ‹å‡º`token`å­˜å‚¨åœ¨å“åº”ç»“æ„ä½“ä¸­å³`body`ï¼Œé‚£æˆ‘ä»¬å®Œå…¨å¯ä»¥åŸºäºå¯¹è±¡æ–¹å¼æå–tokenï¼Œæå–çš„è¡¨è¾¾å¼ï¼š`body.data.token`ï¼Œæå–å®Œåå­˜å‚¨åœ¨æŸä¸ªå˜é‡tokenä¸­ï¼Œå› æ­¤æœ€åçš„è§„åˆ™ï¼š`token: body.data.token`

* å‚æ•°å¦‚ä½•å¼•ç”¨ï¼Ÿ
    
    ä¸Šé¢æˆ‘ä»¬å·²ç»æŠŠtokenæå–å‡ºæ¥äº†ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•å¼•ç”¨å‘¢ï¼Ÿ`hrun4j`å¼•ç”¨è§„åˆ™ï¼š`${æå–çš„å˜é‡å}`ï¼Œå³å¯å®Œæˆå‚æ•°å¼•ç”¨
    

æœ€ç»ˆä¼˜åŒ–çš„è„šæœ¬å¦‚ä¸‹ï¼š

1. `getToken.yml`è„šæœ¬ï¼š

    ```
    config:
      name: Testcase Description
    teststeps:
    - name: Request api:/api/get-token
      variables:
        device_sn: lematech
        os_platform: pc
        app_version: 1.0.0
      request:
        url: http://127.0.0.1:8000/api/get-token
        method: POST
        headers:
          device_sn: ${device_sn}
          app_version: ${app_version}
          os_platform: ${os_platform}
        json:
          sign: ${signGenerate(device_sn,os_platform,app_version)}
      validate:
      - eq:
        - status_code
        - 200
      - eq:
        - body.code
        - '00'
      extract:
        - token: body.data.token
    ```
    
2. `addUser.yml`è„šæœ¬ï¼š

    ```
    config:
      name: Testcase Description
      variables: {}
      verify: false
    teststeps:
    - name: ç”¨æˆ·ç™»å½•
      testcase: getToken.yml
    - name: Request api:/api/user/123
      request:
        url: http://127.0.0.1:8000/api/user/123
        method: POST
        headers:
          device_sn: lematech
          token: ${token}
          Content-Type: application/json
        json:
          password: passwod
          name: name
      validate:
      - eq:
        - status_code
        - 200
      - eq:
        - body.code
        - '09'
    
    ```
    
    è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†3ä¸ªæ¡ˆä¾‹ç¼–å†™ï¼Œå¯¹äºæ¡†æ¶ä½¿ç”¨æœ‰äº†åŸºæœ¬äº†è§£ã€‚
    
    
### æµ‹è¯•ç”¨ä¾‹é›†ç¼–å†™
    
åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯æ ¹æ®æµ‹è¯•é˜¶æ®µæˆ–è€…æµ‹è¯•ç”¨ä¾‹å±æ€§æ¥è¿›è¡Œæµ‹è¯•ç”¨ä¾‹åˆ†ç±»çš„ï¼Œä¼šåˆ’åˆ†æˆ`å†’çƒŸç”¨ä¾‹`ã€`é›†æˆç”¨ä¾‹`ã€`å›å½’ç”¨ä¾‹`ã€`ç³»ç»Ÿç”¨ä¾‹`ç­‰ï¼Œç„¶åæŠŠä»–ä»¬å½’çº³æˆæŸä¸€ç±»æµ‹è¯•ç”¨ä¾‹é›†(å…¨éƒ¨ç»Ÿä¸€æ”¾åˆ°`resources/testsuite`)ï¼Œæ¯æ¬¡è¿è¡Œæ—¶ï¼Œç›´æ¥è·‘ä¸€éç„¶åç”Ÿæˆæµ‹è¯•æŠ¥å‘Šã€‚

`hrun4j`æä¾›ä¸¤ç§æµ‹è¯•ç”¨ä¾‹é›†ç¼–å†™çš„æ–¹å¼ï¼Œä¸€ç§ç¼–å†™`testsuite.yml`ï¼Œå¦ä¸€ç§æ˜¯ç¼–å†™`testng.xml`ï¼Œå…³äºä¸¤ç§å·®å¼‚æ€§å¦‚ä¸‹ï¼š

1. `testng.xml`æ˜¯åŸºäº`POM`æ¨¡å¼ä¸‹ä¸“ç”¨çš„ï¼Œå…¶åº•å±‚æ˜¯æƒ³ç›´æ¥å¤ç”¨testngèƒ½åŠ›ï¼Œå› ä¸ºå®ƒå¤ªå¼ºå¤§äº†ï¼
2. `testsuite.yml`ä¹Ÿå¯ä»¥é…ç½®æµ‹è¯•ç”¨ä¾‹é›†ï¼Œå®ƒå¯ä»¥ç”¨åœ¨`POM`å’Œ`CLI`ï¼Œä½†åœ¨`POM`å¦‚æœæ¶‰åŠåˆ°è‡ªå®šä¹‰`aviator`è„šæœ¬ç¼–å†™æ—¶ï¼Œä¸å¯ç”¨ï¼
å› æ­¤å»ºè®®`CLI`ä¸‹ä½¿ç”¨`testsuite.yml`,`POM`æ¨¡å¼ä¸‹ä½¿ç”¨`testng.xml`ç¼–å†™æµ‹è¯•ç”¨ä¾‹é›†ã€‚

æœ€åæˆ‘ä»¬æŠŠæˆ‘ä»¬ç¼–å†™å¥½çš„ä¸‰ä¸ªç”¨ä¾‹ç»„è£…æˆæµ‹è¯•ç”¨ä¾‹é›†å¹¶å‘½åæˆï¼š`best_practice.xml`ï¼Œå…¶é…ç½®å¦‚ä¸‹ï¼š

```xml
<!DOCTYPE suite SYSTEM "http://testng.org/testng-1.0.dtd" >
<suite name="Best Practice HttpRunner 4J demo testsuite" parallel="false">
    <listeners>
        <listener class-name="org.uncommons.reportng.HTMLReporter"/>
        <listener class-name="org.uncommons.reportng.JUnitXMLReporter"/>
    </listeners>
    <test name="Hello hrun4j">
        <classes>
            <class name="vip.lematech.hrun4j.quickstartdemo.testcases.IndexTest">
            </class>
        </classes>
    </test>
    <test name="ç”¨æˆ·æ¨¡å—">
        <classes>
            <class name="vip.lematech.hrun4j.quickstartdemo.testcases.user.UserTest">
            </class>
        </classes>
    </test>
</suite>

```

é€‰æ‹©æ–‡ä»¶å³è¾¹è¿è¡Œï¼Œæ•ˆæœå¦‚ä¸‹ï¼š
![-w1321](http://cdn.lematech.vip/mweb/16252975653020.jpg)

æ˜¯ä¸æ˜¯å¾ˆç®€å•å•Šï¼ï¼ï¼

ä¹‹æ‰€ä»¥è€ƒè™‘å€ŸåŠ©testngæ¥ç»„ç»‡æµ‹è¯•ç”¨ä¾‹åŠè¿è¡Œï¼Œå› ä¸ºä»–å¤ªå¼ºå¤§äº†ï¼Œå®ƒæ˜¯å„ç±»ç«¯åˆ°ç«¯çš„æµ‹è¯•è§£å†³æ–¹æ¡ˆã€‚

### æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•ç”¨ä¾‹é›†è·‘å®Œä¹‹åï¼Œä¼šåœ¨å½“å‰å·¥ç¨‹ä¸‹ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼ŒæŠ¥å‘Šç›®å½•åœ¨ï¼š`test-output`ï¼Œæ‰“å¼€æŠ¥å‘Š`html/index.html`é¡µé¢ï¼ŒæŠ¥å‘Šæ•ˆæœå¦‚ä¸‹ï¼š

1. æ¦‚è§ˆæŠ¥å‘Šï¼š
    ![-w1435](http://cdn.lematech.vip/mweb/16252978070550.jpg)
2. è¯¦ç»†æŠ¥å‘Šï¼š
    ![-w1434](http://cdn.lematech.vip/mweb/16252978468039.jpg)
3. è¯¦ç»†æ—¥å¿—
    ![-w1429](http://cdn.lematech.vip/mweb/16252978879567.jpg)


### æŒç»­é›†æˆ

åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•éƒ½æ˜¯è·Ÿæµæ°´çº¿æ‰“é€šçš„ï¼Œä¹Ÿå°±æ˜¯å¼€å‘éƒ¨ç½²å®Œåï¼Œè‡ªåŠ¨è§¦å‘è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹é›†è¿›è¡Œæ„å»ºï¼Œæ„å»ºå®Œäº†æŠŠæµ‹è¯•æŠ¥å‘Šå‘é€åˆ°ç›¸å…³ç ”å‘æµ‹è¯•é‚®ç®±ä¸­ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•æŠŠå·¥ç¨‹å†…å»ºåˆ°æµæ°´çº¿ä¸­å‘¢ï¼Ÿ

åœ¨å†…å»ºåˆ°æµæ°´çº¿å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£å¦‚ä½•æŠŠå·¥ç¨‹ä¸‹çš„æµ‹è¯•ç”¨ä¾‹é›†é€šè¿‡`maven`å‘½ä»¤è·‘èµ·æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹æ‰§è¡Œ`mvn clean test`å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šæŠŠå½“å‰å·¥ç¨‹ä¸‹çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨è·‘äº†ï¼Œä½†æˆ‘ä»¬åªéœ€è¦è·‘æˆ‘ä»¬é…ç½®å¥½çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ

å…ˆçœ‹`pom.xml`é…ç½®ï¼š

```
<plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <configuration>
                    <suiteXmlFiles>
                        <suiteXmlFile>${xmlFileName}</suiteXmlFile>
                    </suiteXmlFiles>
                </configuration>
            </plugin>
        </plugins>
```
å¯ä»¥çœ‹å‡ºpomæ„å»ºçš„çš„æ—¶å€™å¯ä»¥æŒ‡å®šè·‘é‚£ä¸ªæµ‹è¯•ç”¨ä¾‹é›†é…ç½®æ–‡ä»¶çš„ï¼Œå› æ­¤
æ„å»ºå‘½ä»¤å¯æŒ‡å®šæŸä¸ªæµ‹è¯•ç”¨ä¾‹é›†ï¼ˆå³`å‚æ•°åŒ–æ„å»º`ï¼‰,å‚æ•°åŒ–æ„å»ºå‘½ä»¤å¦‚ä¸‹ï¼š

`mvn clean test -DxmlFileName=src/test/resources/testsuite/best_practice.xml`

å¦‚æœè¦åšæŒç»­é›†æˆï¼Œå¯ç›´æ¥æŠŠæ•´ä¸ªå·¥ç¨‹æäº¤åˆ°gitï¼Œç„¶ååœ¨Jenkinsé…ç½®å¥½Mavenå’Œæ–°å¢æµ‹è¯•ç”¨ä¾‹é›†å˜é‡ï¼Œå³å¯å®Œæˆå‚æ•°åŒ–æ„å»ºå†…ç½®åˆ°æµæ°´çº¿ä¸­ã€‚

## è¡¥å……è¯´æ˜

### å…³äºè„šæ‰‹æ¶å·¥ç¨‹è¯´æ˜

ä¸è¿‡`CLI`è¿˜æ˜¯`POM`æ¨¡å¼ä¸‹ï¼Œç”Ÿæˆçš„è„šæ‰‹æ¶ï¼Œæœ‰éå¸¸è¯¦ç»†çš„è¯´æ˜ï¼Œå‡ ä¹å·²ç»åŒ…å«äº†æ¡†æ¶æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡è„šæ‰‹æ¶è‡ªå­¦ï¼Œåœ¨å¼€å‘è„šæœ¬å‰ï¼Œå»ºè®®å…ˆè¯»`ReadMe.md`æ–‡æ¡£ï¼Œäº†è§£é¡¹ç›®ç»„ç»‡æ¶æ„åŠåŠŸèƒ½æ¨¡å—åˆ’åˆ†ã€‚

### è§‰å¾—`CLI`æ¨¡å¼æ›´æ–¹ä¾¿ï¼Ÿ

å¦‚æœä½ ä¹ æƒ¯ä½¿ç”¨`CLI`æ¨¡å¼ï¼Œå¯ç›´æ¥æŠŠ`POM`ä¸‹çš„`resources`è½¬å˜æˆ`CLI`é¡¹ç›®å·¥ç¨‹ï¼Œç„¶åæŠŠ`Aviator`è„šæœ¬åˆ‡æ¢æˆ`BeanShell`å³å¯ï¼Œå†é€šè¿‡`testsuite.yml`ç®¡ç†æµ‹è¯•ç”¨ä¾‹é›†ã€‚

### æœ€ä½³å®è·µå·¥ç¨‹ä¸‹è½½

æŒ‰ä¸Šé¢æ“ä½œæ²¡æˆåŠŸï¼Ÿ ç‚¹å‡»[è¿™é‡Œ](https://cdn.lematech.vip/quick-start-demo.zip)ï¼Œä¸‹è½½å·¥ç¨‹ä»£ç 
